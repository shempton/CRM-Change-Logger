# CRM Change Logger

Система логирования изменений в CRM (Битрикс24) для сущностей: Лиды, Сделки, Компании. Проект включает в себя Highload-блок для хранения логов, слушатель изменений, страницу для отображения логов и агент для очистки старых записей.

## Возможности

- Логирование изменений в сущностях CRM (Лид, Сделка, Компания).
- Хранение логов в Highload-блоке.
- Фильтрация логов по пользователю и дате.
- Автоматическая очистка логов старше 1 месяца.

## Установка

1. **Создание Highload-блока:**
   - Создайте Highload-блок с именем `CRMChangeLog` и следующими полями:
     - `USER_ID` (Привязка к пользователям)
     - `ENTITY_ID` (Строка)
     - `ELEMENT_ID` (Число)
     - `CHANGE_LOG` (Текст)
     - `DATE` (Дата и время)

2. **Добавление функционала в init.php:**
   - Откройте/Создайте папку `php_interface` в `local/`.
   - Переместите скрипт из `init.php` в `php_interface/init.php`

3. **Создание страницы для отображения логов:**
   - Создайте страницу, например, `/crm-logs/`, и добавьте на неё код из файла `index.php`.

4. **Настройка агента для очистки логов:**
   - Добавьте агента, который будет удалять логи старше 1 месяца. Используйте файл `crm_log_cleaner.php`.

## Использование

### Логирование изменений
- Срабатывает автоматически при изменении данных в элементах сущности.

### Просмотр логов
- Перейдите на страницу `/crm-logs/`, чтобы увидеть таблицу с логами.
- Используйте фильтры для поиска логов по пользователю и дате.

### Очистка логов
- Агент автоматически удаляет логи старше 1 месяца. Запуск агента происходит раз в день.
